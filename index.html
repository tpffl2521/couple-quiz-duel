<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Couple Quiz Duel</title>
  <style>
    :root {
      --bg1: #ff9a9e;
      --bg2: #fad0c4;
      --bg3: #fbc2eb;
      --bg4: #a6c1ee;
      --card: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --accent: #ff6b6b;
      --accent-2: #7c3aed;
      --accent-3: #10b981;
      --accent-4: #f59e0b;
      --shadow: 0 10px 30px rgba(0,0,0,.12);
      --radius: 22px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: linear-gradient(135deg, var(--bg1) 0%, var(--bg3) 45%, var(--bg4) 100%);
      background-attachment: fixed;
    }
    .wrap { min-height: 100%; display: grid; place-items: center; padding: 20px; }
    .card { width: 100%; max-width: 880px; background: linear-gradient(180deg, #fff, #fff8ff); border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; }
    header { padding: 18px 20px; display: flex; align-items: center; justify-content: space-between; background: linear-gradient(90deg, #ffe4e6, #e9d5ff, #dbeafe); }
    .brand { display: flex; align-items: center; gap: 12px; font-weight: 900; letter-spacing: .2px; }
    .brand .logo { width: 40px; height: 40px; border-radius: 50%; background: conic-gradient(from 0deg, var(--accent), var(--accent-2), var(--accent-3), var(--accent-4), var(--accent)); box-shadow: 0 6px 14px rgba(0,0,0,.15) inset; }
    .brand small { display:block; font-weight:600; color: #6b21a8; margin-top:-4px }
    .content { padding: 20px; }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    @media (max-width: 720px) { .grid-2 { grid-template-columns: 1fr; } }

    input[type="text"], input[type="number"], textarea, select {
      width: 100%;
      border: 2px solid #f1f5f9;
      background: #fff;
      border-radius: 14px;
      padding: 14px 16px;
      font-size: 16px;
      outline: none;
      transition: border .15s ease, box-shadow .15s ease;
    }
    input:focus, textarea:focus, select:focus { border-color: #c4b5fd; box-shadow: 0 0 0 4px #ede9fe; }

    .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; border: 0; cursor: pointer; user-select: none; font-weight: 800; letter-spacing: .3px; border-radius: 14px; padding: 14px 18px; font-size: 16px; background: linear-gradient(90deg, #fb7185, #a78bfa); color: white; box-shadow: var(--shadow); transition: transform .06s ease, filter .2s ease; }
    .btn:active { transform: translateY(1px) scale(.99); }
    .btn.secondary { background: linear-gradient(90deg, #34d399, #fbbf24); color: #0f172a; }
    .btn.ghost { background: #fff; color: #475569; border: 2px dashed #e5e7eb; box-shadow: none; }

    .badge { display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; background:#f1f5f9; color:#334155; font-weight:700; }
    .pill { padding: 10px 12px; border-radius: 999px; background: #0ea5e9; color:white; font-weight:800; }
    .k { display:flex; flex-wrap:wrap; gap:10px; }
    .hidden { display: none !important; }
    .center { text-align: center; }

    .players { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px; }
    @media (max-width:720px){ .players { grid-template-columns: 1fr; } }

    .player { background: #ffffff; border: 2px solid #f3f4f6; padding: 12px; border-radius: 16px; display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .player.active { border-color: #a78bfa; box-shadow: 0 0 0 3px #ede9fe; }
    .player .name { font-weight: 900; font-size: 18px; }
    .player .score { font-size: 28px; font-weight: 900; }

    .question-box { margin-top: 14px; background: linear-gradient(180deg,#fff,#fff 60%,#fff6); border: 2px solid #f1f5f9; border-radius: 18px; padding: 16px; }
    .qtext { font-size: 20px; font-weight: 900; line-height: 1.3; }

    .options { display:grid; grid-template-columns:1fr; gap:10px; margin-top:12px; }
    .opt { padding: 14px; border-radius: 14px; border:2px solid #f1f5f9; background:#fff; cursor:pointer; font-weight:800; }
    .opt:hover { border-color:#e9d5ff; }
    .opt.correct { border-color:#34d399; background: #ecfdf5; }
    .opt.wrong { border-color:#fb7185; background: #fff1f2; }

    .footer { margin-top: 14px; display:flex; flex-wrap: wrap; gap:10px; align-items:center; justify-content:space-between; }
    .chip { font-weight:800; padding:10px 12px; border-radius:12px; background:#eef2ff; color:#3730a3; }
    .divider { height: 1px; background: #f1f5f9; margin: 16px 0; }

    .leaderboard { display:grid; gap:10px; }
    .row { display:flex; align-items:center; justify-content:space-between; background:#fff; border:2px solid #f1f5f9; padding:12px; border-radius:12px; }
    .row small { color:#64748b; font-weight:700; }

    .toast { position: fixed; inset: auto 16px 16px 16px; display:none; }
    .toast.show { display:block; animation: pop .2s ease; }
    .toast > div{ background:#111827; color:#fff; padding:12px 14px; border-radius:12px; box-shadow: var(--shadow); }
    @keyframes pop { from{ transform: translateY(8px); opacity:0 } to{ transform: translateY(0); opacity:1 } }

    .ribbon { position: absolute; top: 8px; right: -10px; transform: rotate(8deg); background: #22c55e; color:#fff; padding:6px 12px; border-radius:10px; font-weight:900; box-shadow: var(--shadow); }

    .timer { display:inline-flex; align-items:center; gap:8px; font-weight:900; padding:8px 12px; border-radius:12px; background:#ffe4e6; color:#9f1239; }
    .timer.low { background:#fee2e2; color:#991b1b; animation: blink .8s steps(1,end) infinite; }
    @keyframes blink { 50% { opacity:.3 } }
    .text-input { display:flex; gap:8px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <div>Couple Quiz Duel</div>
            <small>Colorful ‚Ä¢ Mobile‚Äëfriendly ‚Ä¢ Seru untuk berdua üíû</small>
          </div>
        </div>
        <div class="k">
          <button class="btn ghost" id="btn-how">Cara main</button>
          <button class="btn secondary" id="btn-manage">Kelola pertanyaan</button>
        </div>
      </header>

      <!-- SETUP -->
      <section id="setup" class="content">
        <h2 class="center" style="margin:6px 0 14px 0">Masukkan nama pemain</h2>
        <div class="grid-2">
          <div>
            <label>Player A</label>
            <input id="p1" type="text" placeholder="contoh: Kamu" value="Kamu" />
          </div>
          <div>
            <label>Player B</label>
            <input id="p2" type="text" placeholder="contoh: Dia" value="Dia" />
          </div>
        </div>
        <div class="grid-2" style="margin-top:10px">
          <div>
            <label>Jumlah ronde</label>
            <select id="rounds">
              <option value="5">5</option>
              <option value="8" selected>8</option>
              <option value="10">10</option>
              <option value="12">12</option>
              <option value="all">Semua pertanyaan</option>
            </select>
          </div>
          <div>
            <label>Mode giliran</label>
            <select id="turnMode">
              <option value="alternate" selected>Bergantian</option>
              <option value="steal">Bisa rebut (steal) jika salah</option>
            </select>
          </div>
        </div>
        <div class="grid-2" style="margin-top:10px">
          <div>
            <label>Timer per soal (detik)</label>
            <div class="text-input">
              <input id="timerSec" type="number" value="15" min="5" max="120" />
              <label style="display:flex; align-items:center; gap:6px"><input id="timerOn" type="checkbox" checked /> Aktif</label>
            </div>
          </div>
          <div>
            <label>Case sensitive untuk jawaban teks</label>
            <select id="caseMode">
              <option value="insensitive" selected>Abaikan huruf besar/kecil</option>
              <option value="sensitive">Perhatikan huruf besar/kecil</option>
            </select>
          </div>
        </div>
        <div class="center" style="margin-top:16px">
          <button class="btn" id="start">Mulai Duel üí•</button>
        </div>
        <div class="divider"></div>
        <div>
          <h3 style="margin:0 0 8px 0">Leaderboard Lucu</h3>
          <div id="board" class="leaderboard"></div>
        </div>
      </section>

      <!-- GAME -->
      <section id="game" class="content hidden">
        <div class="players">
          <div id="paneA" class="player"><span class="name" id="nA">A</span><span class="score" id="sA">0</span></div>
          <div id="paneB" class="player"><span class="name" id="nB">B</span><span class="score" id="sB">0</span></div>
        </div>
        <div class="question-box">
          <div class="k" style="justify-content:space-between; align-items:center">
            <span class="badge" id="roundBadge">Ronde 1</span>
            <span class="chip" id="turnBadge">Giliran: <b id="turnName">-</b></span>
            <span class="timer hidden" id="timer">‚è± <b id="tsec">15</b>s</span>
          </div>
          <div class="qtext" id="qtext" style="margin-top:10px">‚Äî</div>
          <div class="options" id="options"></div>
        </div>
        <div class="footer">
          <div class="k">
            <button class="btn ghost" id="skip">Lewati</button>
            <button class="btn secondary" id="end">Akhiri & Lihat Hasil</button>
          </div>
          <div class="pill" id="leftCount">Sisa: 0</div>
        </div>
      </section>

      <!-- RESULT -->
      <section id="result" class="content hidden">
        <div style="position:relative">
          <div id="ribbon" class="ribbon hidden">Juara!</div>
          <h2 class="center" style="margin:4px 0 10px 0">Hasil Duel</h2>
        </div>
        <div class="players">
          <div class="player">
            <div>
              <div class="name" id="resA"></div>
              <small class="muted" id="titleA"></small>
            </div>
            <div class="score" id="scoreA"></div>
          </div>
          <div class="player">
            <div>
              <div class="name" id="resB"></div>
              <small class="muted" id="titleB"></small>
            </div>
            <div class="score" id="scoreB"></div>
          </div>
        </div>
        <div class="center" style="margin-top:14px" id="summary"></div>
        <div class="center" style="margin-top:14px">
          <button class="btn" id="again">Main lagi</button>
          <button class="btn secondary" id="home">Kembali ke menu</button>
        </div>
      </section>
    </div>
  </div>

  <!-- Simple modals (how, manage) -->
  <dialog id="howModal" style="max-width:720px; border:0; border-radius:16px; box-shadow:var(--shadow);">
    <form method="dialog" style="padding:0">
      <header style="padding:14px 16px; background:#f0f9ff"><b>Bagaimana cara main?</b></header>
      <div style="padding:16px;">
        <ol>
          <li>Isi nama Player A dan Player B, pilih jumlah ronde.</li>
          <li>Pilih mode giliran: bergantian atau <i>steal</i>.</li>
          <li>Aktifkan timer per soal jika mau lebih menantang.</li>
          <li>Pertanyaan bisa bertipe <b>Multiple Choice</b>, <b>True/False</b>, atau <b>Jawaban Teks</b>.</li>
          <li>Skor otomatis, di akhir muncul gelar lucu: <b>‚ÄúRaja Ingatan‚Äù</b> vs <b>‚ÄúSi Lupa Manis‚Äù</b>.</li>
        </ol>
      </div>
      <div style="padding:12px 16px; display:flex; justify-content:flex-end; gap:10px; background:#f8fafc">
        <button class="btn ghost">Tutup</button>
      </div>
    </form>
  </dialog>

  <dialog id="manageModal" style="max-width:920px; border:0; border-radius:16px; box-shadow:var(--shadow);">
    <form method="dialog" style="padding:0">
      <header style="padding:14px 16px; background:#fef3c7">
        <b>Kelola Pertanyaan</b>
        <small style="color:#92400e; font-weight:700">(klik simpan untuk menyimpan ke perangkat ini)</small>
      </header>
      <div style="padding:16px;">
        <details open>
          <summary style="cursor:pointer; font-weight:800; margin-bottom:10px">Format JSON (3 tipe)</summary>
          <div style="margin-top:6px; color:#475569">
            <ul>
              <li><b>Multiple Choice (default)</b>: <code>{"type":"mc","q":"teks","options":["A","B","C"],"answer":0}</code></li>
              <li><b>True/False</b>: <code>{"type":"tf","q":"teks","answer":true}</code></li>
              <li><b>Teks</b>: <code>{"type":"text","q":"teks","answers":["jawaban1","jawaban2"]}</code> (cocok sebagian/tepat, tidak case sensitive bila di setelan pilih "abaikan")</li>
            </ul>
          </div>
        </details>
        <textarea id="jsonBox" rows="16" style="width:100%; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace"></textarea>
        <div class="k" style="margin-top:10px">
          <button class="btn" id="saveQuestions" type="button">Simpan</button>
          <button class="btn secondary" id="resetQuestions" type="button">Reset ke bawaan</button>
          <button class="btn ghost" id="exportBtn" type="button">Ekspor .json</button>
          <input id="importFile" type="file" accept="application/json" class="hidden" />
          <button class="btn ghost" id="importBtn" type="button">Impor .json</button>
          <button class="btn ghost" value="cancel">Tutup</button>
        </div>
      </div>
    </form>
  </dialog>

  <div class="toast" id="toast"><div id="toastMsg">Tersimpan!</div></div>

  <script>
    // ===== Util =====
    const $ = (q) => document.querySelector(q);
    const $$ = (q) => document.querySelectorAll(q);
    const vibrate = (pat) => { if (navigator.vibrate) navigator.vibrate(pat); };
    const shuffle = (arr) => arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(v=>v[1]);
    const show = (id) => { $('#setup').classList.add('hidden'); $('#game').classList.add('hidden'); $('#result').classList.add('hidden'); $(id).classList.remove('hidden'); };
    const toast = (msg) => { const t=$('#toast'); $('#toastMsg').textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 1400); };

    // ===== Default questions (editable) =====
    const DEFAULT_QUESTIONS = [
      { type: "mc", q: "Apa makanan favoritku?", options: ["Sushi", "Bakso", "Ayam Geprek", "Mie Goreng"], answer: 1 },
      { type: "mc", q: "Tanggal kita pertama kali jalan bareng?", options: ["14 Feb", "1 Jan", "7 Juli", "24 Mei"], answer: 0 },
      { type: "mc", q: "Minuman yang paling sering aku pesan?", options: ["Es Teh Manis", "Kopi Susu", "Jus Alpukat", "Boba"], answer: 1 },
      { type: "tf", q: "Aku alergi udang.", answer: true },
      { type: "mc", q: "Aku paling suka liburan ke‚Ä¶", options: ["Pantai", "Gunung", "Kota", "Rumah aja"], answer: 0 },
      { type: "text", q: "Sebutkan warna favoritku.", answers: ["hijau","ijo"] },
      { type: "mc", q: "Kalau quality time, aku lebih suka‚Ä¶", options: ["Nonton", "Jalan sore", "Masak bareng", "Main game"], answer: 3 },
      { type: "mc", q: "Hal kecil yang bikin aku senang?", options: ["Chat pagi", "Dibelikan snack", "Dipijat", "Surat lucu"], answer: 0 }
    ];

    const STORAGE_KEY_Q = 'couple-quiz-questions-v2';
    const STORAGE_KEY_B = 'couple-quiz-board-v1';

    function loadQuestions(){
      try {
        const raw = localStorage.getItem(STORAGE_KEY_Q);
        if (!raw) return DEFAULT_QUESTIONS.slice();
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) throw 0;
        return parsed;
      } catch (e){ return DEFAULT_QUESTIONS.slice(); }
    }
    function saveQuestions(arr){ localStorage.setItem(STORAGE_KEY_Q, JSON.stringify(arr)); }
    function loadBoard(){ try { return JSON.parse(localStorage.getItem(STORAGE_KEY_B)) || []; } catch(e){ return []; } }
    function saveBoard(b){ localStorage.setItem(STORAGE_KEY_B, JSON.stringify(b)); }

    // ===== Timer =====
    let timerId = null; let tLeft = 0;
    function startTimer(sec){
      if (!$('#timerOn').checked) { $('#timer').classList.add('hidden'); return; }
      clearInterval(timerId);
      tLeft = sec; $('#tsec').textContent = tLeft; $('#timer').classList.remove('hidden'); $('#timer').classList.remove('low');
      timerId = setInterval(()=>{
        tLeft--; $('#tsec').textContent = tLeft;
        if (tLeft <= 5) $('#timer').classList.add('low');
        if (tLeft <= 0){ clearInterval(timerId); timesUp(); }
      }, 1000);
    }
    function stopTimer(){ clearInterval(timerId); $('#timer').classList.add('hidden'); }

    // ===== State =====
    let QUESTIONS = loadQuestions();
    let game = { p1: 'Kamu', p2: 'Dia', turn: 1, a: 0, b: 0, i: 0, order: [], turnMode: 'alternate', asked: [], caseSensitive: false };

    // ===== Setup UI =====
    function renderBoard(){
      const board = loadBoard();
      const el = $('#board');
      el.innerHTML = '';
      if (!board.length){ el.innerHTML = '<div class="row"><b>Belum ada catatan. Main dulu yuk! üéâ</b></div>'; return; }
      board.slice(0, 10).forEach((r, idx)=>{
        const row = document.createElement('div');
        row.className='row';
        const title = r.title || (r.winner+" ‚Äî Raja Ingatan");
        const names = `${r.p1} vs ${r.p2}`;
        row.innerHTML = `<div><b>${idx+1}. ${title}</b><br><small>${names} ‚Ä¢ ${r.score}</small></div><small>${new Date(r.ts).toLocaleString()}</small>`;
        el.appendChild(row);
      })
    }

    function openManage(){ $('#jsonBox').value = JSON.stringify(QUESTIONS, null, 2); $('#manageModal').showModal(); }

    function startGame(){
      game.p1 = $('#p1').value.trim() || 'Player A';
      game.p2 = $('#p2').value.trim() || 'Player B';
      game.turnMode = $('#turnMode').value;
      game.caseSensitive = $('#caseMode').value === 'sensitive';
      game.a = 0; game.b = 0; game.i = 0; game.turn = 1; game.asked = [];

      $('#nA').textContent = game.p1; $('#nB').textContent = game.p2;
      $('#sA').textContent = '0'; $('#sB').textContent = '0';

      const pool = QUESTIONS.slice();
      const want = $('#rounds').value === 'all' ? pool.length : parseInt($('#rounds').value, 10);
      game.order = shuffle([...Array(pool.length).keys()]).slice(0, want);

      $('#leftCount').textContent = `Sisa: ${want}`;
      $('#roundBadge').textContent = `Ronde 1`;
      $('#turnName').textContent = game.turn === 1 ? game.p1 : game.p2;

      show('#game');
      nextQuestion();
    }

    function renderOptions(q){
      const ops = $('#options');
      ops.innerHTML = '';
      if (q.type === 'tf'){
        ['Benar','Salah'].forEach((label, i)=>{
          const b = document.createElement('button'); b.className='opt'; b.type='button'; b.textContent=label;
          b.addEventListener('click', ()=> handleAnswer((i===0) === !!q.answer)); ops.appendChild(b);
        });
      } else if (q.type === 'text'){
        const wrap = document.createElement('div'); wrap.className='text-input';
        const input = document.createElement('input'); input.type='text'; input.placeholder='Ketik jawaban...'; input.autofocus = true; input.className='opt';
        const submit = document.createElement('button'); submit.className='btn'; submit.type='button'; submit.textContent='Jawab';
        submit.addEventListener('click', ()=>{
          const ans = input.value.trim();
          let ok = false;
          for (const a of (q.answers||[])){
            if (!game.caseSensitive){ if (ans.toLowerCase() === String(a).toLowerCase()) { ok = true; break; } }
            else { if (ans === String(a)) { ok = true; break; } }
          }
          handleAnswer(ok);
        });
        input.addEventListener('keydown', (e)=>{ if (e.key==='Enter') submit.click(); });
        wrap.appendChild(input); wrap.appendChild(submit); ops.appendChild(wrap);
      } else {
        (q.options||[]).forEach((opt, oi)=>{
          const b = document.createElement('button'); b.className='opt'; b.type='button'; b.textContent = opt;
          b.addEventListener('click', ()=> handleAnswer(oi === q.answer)); ops.appendChild(b);
        });
      }
    }

    function nextQuestion(){
      stopTimer();
      if (game.i >= game.order.length){ finishGame(); return; }
      const idx = game.order[game.i];
      const q = QUESTIONS[idx];
      $('#qtext').textContent = q.q;
      renderOptions(q);
      markActive();
      $('#roundBadge').textContent = `Ronde ${game.i+1}`;
      $('#leftCount').textContent = `Sisa: ${game.order.length - game.i}`;
      if ($('#timerOn').checked){ startTimer(parseInt($('#timerSec').value,10) || 15); }
    }

    function markActive(){ $('#paneA').classList.toggle('active', game.turn === 1); $('#paneB').classList.toggle('active', game.turn === 2); $('#turnName').textContent = game.turn === 1 ? game.p1 : game.p2; }

    function lockOptions(){ $$('#options .opt, #options button').forEach(o => o.disabled = true); }

    function highlightCorrect(q){
      const opts = $$('#options .opt');
      if (q.type === 'mc'){
        opts.forEach((o, i)=>{ if (i === q.answer) o.classList.add('correct'); else o.classList.add('wrong'); });
      } else if (q.type === 'tf'){
        // two buttons: Benar=0, Salah=1. answer true => index 0 correct
        opts.forEach((o, i)=>{ if ((i===0) === !!q.answer) o.classList.add('correct'); else o.classList.add('wrong'); });
      }
    }

    function handleAnswer(correct){
      stopTimer();
      lockOptions();
      const q = QUESTIONS[game.order[game.i]];
      if (q.type !== 'text') highlightCorrect(q);
      if (correct){
        vibrate([40]);
        if (game.turn === 1) { game.a++; $('#sA').textContent = game.a; } else { game.b++; $('#sB').textContent = game.b; }
        toast('Betul! +1 poin ‚ú®');
        setTimeout(()=>{ game.i++; game.turn = game.turn === 1 ? 2 : 1; nextQuestion(); }, 500);
      } else {
        vibrate([20, 40, 20]);
        if (game.turnMode === 'steal'){
          toast('Salah! Lawan boleh rebut üí´');
          game.turn = game.turn === 1 ? 2 : 1; markActive();
          // re-enable only for steal
          setTimeout(()=>{ $$('#options .opt, #options button').forEach(o => o.disabled = false); if ($('#timerOn').checked){ startTimer(Math.ceil((parseInt($('#timerSec').value,10)||15)/2)); } }, 350);
        } else {
          toast('Salah! üòù');
          setTimeout(()=>{ game.i++; game.turn = game.turn === 1 ? 2 : 1; nextQuestion(); }, 650);
        }
      }
    }

    function timesUp(){ toast('Waktu habis!'); if (game.turnMode === 'steal'){ game.turn = game.turn === 1 ? 2 : 1; markActive(); startTimer(Math.ceil((parseInt($('#timerSec').value,10)||15)/2)); } else { game.i++; game.turn = game.turn === 1 ? 2 : 1; nextQuestion(); } }

    function finishGame(){
      show('#result'); stopTimer();
      $('#resA').textContent = game.p1; $('#resB').textContent = game.p2;
      $('#scoreA').textContent = game.a; $('#scoreB').textContent = game.b;

      let titleA = '', titleB = '';
      if (game.a === game.b){
        titleA = titleB = 'Duo Sinkron ‚Äî Kompak Banget!';
        $('#summary').innerHTML = 'Seri! Sama kuatnya. üíû';
        $('#ribbon').classList.add('hidden');
      } else if (game.a > game.b){
        titleA = 'Raja Ingatan üëë';
        titleB = 'Si Lupa Manis ü´£';
        $('#summary').innerHTML = `${game.p1} menang!`;
        $('#ribbon').classList.remove('hidden');
      } else {
        titleA = 'Si Lupa Manis ü´£';
        titleB = 'Raja Ingatan üëë';
        $('#summary').innerHTML = `${game.p2} menang!`;
        $('#ribbon').classList.remove('hidden');
      }
      $('#titleA').textContent = titleA; $('#titleB').textContent = titleB;

      const record = { ts: Date.now(), p1: game.p1, p2: game.p2, score: `${game.a} : ${game.b}`, winner: game.a === game.b ? 'Seri' : (game.a > game.b ? game.p1 : game.p2), title: game.a === game.b ? 'Duel Seri ‚Äî Kompak!' : 'Raja Ingatan' };
      const board = loadBoard(); board.unshift(record); saveBoard(board); renderBoard();
    }

    // ===== Import / Export =====
    function exportJSON(){
      const blob = new Blob([JSON.stringify(QUESTIONS, null, 2)], {type:'application/json'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'couple-quiz-questions.json'; a.click(); URL.revokeObjectURL(a.href);
    }
    function importJSON(file){
      const reader = new FileReader();
      reader.onload = (e)=>{
        try{
          const val = JSON.parse(e.target.result);
          if (!Array.isArray(val)) throw 0;
          val.forEach(v=>{ if (!v.q || typeof v.q !== 'string') throw 0; });
          QUESTIONS = val; saveQuestions(val); $('#jsonBox').value = JSON.stringify(QUESTIONS, null, 2); toast('Impor berhasil ‚úì');
        } catch{ toast('File tidak valid.'); }
      };
      reader.readAsText(file);
    }

    // ===== Events =====
    $('#btn-how').addEventListener('click', ()=> $('#howModal').showModal());
    $('#btn-manage').addEventListener('click', openManage);
    $('#start').addEventListener('click', startGame);
    $('#skip').addEventListener('click', ()=>{ toast('Lewati'); game.i++; game.turn = game.turn === 1 ? 2 : 1; nextQuestion(); });
    $('#end').addEventListener('click', finishGame);
    $('#again').addEventListener('click', ()=>{ show('#game'); game.a=0; game.b=0; $('#sA').textContent = 0; $('#sB').textContent=0; game.i=0; nextQuestion(); });
    $('#home').addEventListener('click', ()=>{ show('#setup'); });

    $('#saveQuestions').addEventListener('click', ()=>{
      try{
        const val = JSON.parse($('#jsonBox').value);
        if (!Array.isArray(val)) throw 0;
        val.forEach(v=>{ if (!v.q || (v.type==='mc' && (!Array.isArray(v.options) || typeof v.answer !== 'number')) ) {/* allow tf/text minimal check */} });
        QUESTIONS = val; saveQuestions(val); toast('Pertanyaan disimpan ‚úì');
      } catch(e){ toast('Format tidak valid. Periksa lagi ya.'); }
    });

    $('#resetQuestions').addEventListener('click', ()=>{ QUESTIONS = DEFAULT_QUESTIONS.slice(); $('#jsonBox').value = JSON.stringify(QUESTIONS, null, 2); saveQuestions(QUESTIONS); toast('Sudah kembali ke daftar bawaan ‚úì'); });

    $('#exportBtn').addEventListener('click', exportJSON);
    $('#importBtn').addEventListener('click', ()=> $('#importFile').click());
    $('#importFile').addEventListener('change', (e)=>{ if (e.target.files && e.target.files[0]) importJSON(e.target.files[0]); });

    // init
    renderBoard();
  </script>
</body>
</html>
